A caching nameserver stores DNS query results temporarily to improve performance and reduce the load on authoritative nameservers. This guide covers the setup and configuration of a caching nameserver using BIND (Berkeley Internet Name Domain).

## Check Hostname

### Update Hostname

### Display Current Hostname

```
hostname

```

### Open the hostname configuration file

```
vim /etc/hostname

```

Sour.Local

### Reboot the System

```
reboot

```

### Confirm the Hostname Change

```
hostname

```

## Install and Configure BIND

### Check if BIND is Installed

```
rpm -qa | grep bind

```

### Install BIND and Utilities

```
yum install bind

```

```
yum install bind*

```

### Verify Installation

```
rpm -qa | grep bind

```

### Get Information About the Installed Package

```
rpm -qi bind

```

### List Installed Files

```
rpm -ql bind

```

### List Configuration Files

```
rpm -qc bind

```

## Key Configuration Files

### /etc/named.conf

This is the main configuration file for BIND.

It defines the server options, zones, logging settings, access control lists (ACLs), and security policies.

Example configurations:

Which IP addresses and ports to listen on.

Allowed clients for DNS queries.

Path to zone files.

### /etc/named.iscdlv.key

Contains a TSIG (Transaction Signature) key used for secure communication between DNS servers.

Primarily used for:

DNS dynamic updates.

Zone transfers between servers.

This file is often autogenerated and managed by BIND itself.

### /etc/named.rfc1912.zones

Contains the configuration for default zones as defined by RFC 1912.

Defines common zones like:

localhost

0.0.127.in-addr.arpa (for loopback address reverse lookups)

255.in-addr.arpa (for broadcast address reverse lookups)

Helps resolve local network issues and reverse DNS lookups.,,

### /etc/named.root.key

Holds the root trust anchor key for DNSSEC (DNS Security Extensions).

Used to validate responses from the root DNS servers.

If this key is missing or outdated, DNSSEC validation will fail.

### /var/named

This is the working directory for BIND, where zone files and cache data are stored.

### /var/named/data

Contains BIND-generated data files like:

cache_dump.db - Stores cached DNS records.

named_stats.txt -Stores statistics.

named.recursing - Logs recursive queries.

named.secroots - Logs secure root data.,,

### /var/named/named.ca

Contains the list of root DNS servers.

Essential for resolving queries starting from the root.

Loaded into memory when BIND starts to seed the root server list.

### /var/named/named.empty

Used to define an empty zone for queries to unresponsive or non-existent zones.

Prevents unnecessary traffic to root servers for invalid domains.

### /var/named/named.localhost

Defines the zone for localhost (127.0.0.1).

Ensures that the local machine can always resolve its own name.

### /var/named/named.loopback

Used for reverse lookup of 127.0.0.1.

Ensures that the loopback address can be resolved.

### /var/named/slaves

Directory for storing zone files transferred from master DNS servers (if the server is configured as a slave).

Used in secondary DNS setups for redundancy and load balancing.

### View Cache File

```
cat /var/named/named.ca

#for debian 
cat /usr/share/dns/root.hints

```

## Manage BIND Service

### Check Service Status

```
systemctl status named.service

```

### Start the Service

```
systemctl start named.service

```

### Check Open Ports for Named

```
netstat -nltup | grep named

```

```
netstat -nltup | grep 53

```

## Test Using dig

### Test Localhost Resolution

```
dig google.com @127.0.0.1
##this only used for localy no there can use 

```

# Enable the named DNS service to start automatically at boot

```
sudo systemctl enable named.service
```

### Configure Network Settings

### **Change DNS to Local DNS (127.0.0.1)**:(for local use only )

1. **Edit `/etc/resolv.conf` manually** (if it’s not automatically managed by `systemd` or `NetworkManager`):

```bash
sudo nano /etc/resolv.conf

```

1. **Update the nameserver** to your local DNS server (127.0.0.1):

```
nameserver 127.0.0.1

```

1. **Save and exit**: Press `Ctrl + X`, then `Y`, then `Enter`.

#############################################################################

CentOS 7-Modify Network Interface Configuration

Open the network interface configuration file:

```
vim /etc/sysconfig/network-scripts/ifcfg-enp0s3

```

**Example**:

```
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=no
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=enp0s3
UUID=92a9be99-ddba-4e75-a601-a385f8dcb88f
DEVICE=enp0s3
ONBOOT=yes
IPADDR=192.168.1.37
PREFIX=24
GATEWAY=192.168.1.1
DNS1=127.0.0.1
PROXY_METHOD=none
BROWSER_ONLY=no

```

### Modify NetworkManager Connection Configuration

```
vim /etc/NetworkManager/system-connections/enp0s3.nmconnection

```

**Example**:

```
[connection]
id=enp0s3
uuid=5dabe1f1-79aa-3751-8ba8-b0f01d817434
type=ethernet
autoconnect-priority=-999
interface-name=enp0s3
timestamp=1730811905

[ethernet]

[ipv4]
address1=192.168.1.31/24,192.168.1.1
address2=192.168.1.32/24
address3=192.168.1.33/24
address4=192.168.1.34/24
dns=127.0.0.1;
method=manual

[ipv6]
addr-gen-mode=eui64
method=disabled

[proxy]

```

############################################################################

# ab ham chate he baki client bhi ise use kar paye

## Configure BIND (named.conf)

### for debian13 →Example named.conf File

```
vim /etc/named.conf

```

```
#####################
###################3Final Suggested Configuration for Debian 13:
####################################################
options {
  listen-on port 53 { 127.0.0.1; **192.168.1.34**; };
  listen-on-v6 port 53 { ::1; };
  directory "/var/cache/bind";  // Debian convention
  dump-file "/var/cache/bind/data/cache_dump.db";  // Update directory
  statistics-file "/var/cache/bind/data/named_stats.txt";
  memstatistics-file "/var/cache/bind/data/named_mem_stats.txt";
  recursing-file "/var/cache/bind/data/named.recursing";
  secroots-file "/var/cache/bind/data/named.secroots";
  allow-query { localhost; **192.168.1.0/24**; };
  recursion yes;  // Set to no if you don't want recursive queries
  dnssec-enable yes;
  dnssec-validation yes;
  bindkeys-file "/etc/named.root.key";
  managed-keys-directory "/var/cache/bind/dynamic";  // Update directory
  pid-file "/run/named/named.pid";
  session-keyfile "/run/named/session.key";
};

logging {
  channel default_debug {
    file "/var/log/named.log";  // Absolute path for logging
    severity dynamic;
  };
};

zone "." IN {
  type hint;
  file "/usr/share/dns/bind9/root.hints";  // Use default root hints file on Debian
};

include "/etc/named.rfc1912.zones";  // Optional, for reverse zones
include "/etc/named.root.key";  // Optional, for DNSSEC keys

```

### Restart BIND Service

```
systemctl restart named.service

```

### #cheak it work or not you see 53 on your ip and local host also

```

 netstat -nltip | grep 53

```

### duplicate of above  debian →for centoes →Example named.conf File

```
###################this for centoes#########
options {
  listen-on port 53 { 127.0.0.1; 192.168.1.34; };

  listen-on-v6 port 53 { ::1; };
  directory "/var/named";
  dump-file "/var/named/data/cache_dump.db";

  statistics-file "/var/named/data/named_stats.txt";
  memstatistics-file "/var/named/data/named_mem_stats.txt";
  recursing-file "/var/named/data/named.recursing";
  secroots-file "/var/named/data/named.secroots";
  allow-query { localhost; 192.168.1.0/24; };

  recursion yes;

  dnssec-enable yes;
  dnssec-validation yes;

  bindkeys-file "/etc/named.root.key";
  managed-keys-directory "/var/named/dynamic";
  pid-file "/run/named/named.pid";
  session-keyfile "/run/named/session.key";
};

```

```
logging {
  channel default_debug {
    file "data/named.run";
    severity dynamic;
  };
};

```

```
zone "." IN {
  type hint;
  file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";

```

## Configure Firewall Rules (Firewalld)

Allow DNS Traffic (TCP and UDP Port 53):

```
firewall-cmd --permanent --add-port=53/tcp

```

```
firewall-cmd --permanent --add-port=53/udp

```

## if error of above to commmand

1. **If `iptables` is in use**:
    
    ```bash
    sudo iptables -A INPUT -p tcp --dport 53 -j ACCEPT && sudo iptables -A INPUT -p udp --dport 53 -j ACCEPT && sudo netfilter-persistent save
    
    ```
    
2. **If `nftables` is in use**:
    
    ```bash
    sudo nft add rule inet filter input tcp dport 53 accept && sudo nft add rule inet filter input udp dport 53 accept && sudo nft list ruleset > /etc/nftables.conf
    
    ```
    
3. **If `ufw` is in use**:
    
    ```bash
    sudo ufw allow 53/tcp && sudo ufw allow 53/udp
    
    ```
    
    ```
    sudo ufw reload
    
    ```
    
4. **If `firewalld` is in use**:
    
    ```bash
    sudo firewall-cmd --permanent --add-port=53/tcp && sudo firewall-cmd --permanent --add-port=53/udp && sudo firewall-cmd --reload
    
    ```
    
    ```
    firewall-cmd --reload
    
    ```
    

This will permanently open both TCP and UDP port 53 for DNS queries.,,

# “now you can chaek from othe client pc using this command dig ( dig [google.com](http://google.com/) @10.146.125.206) change ip of your server”

# “ye ban gya cache only dns server “

---

---

# Define ACL in named.confn

## the context of DNS (Domain Name System), an **ACL (Access Control List)** is a list of rules that define who can access or query the DNS server. It helps control access based on IP addresses or network ranges, essentially allowing or denying certain clients from using the DNS server.

```
vim /etc/named.conf

```

**Example**:

```
// named.conf
//
// Provided by Red Hat bind package to configure the ISC BIND named (8) DNS
// server as a caching only nameserver (as a localhost DNS resolver only).
//
// See /usr/share/doc/bind/sample/ for example named configuration files.
//

acl ns_ip_add {
  127.0.0.1;
  192.168.1.32;
  192.168.1.40;
  192.168.1.41;
  192.168.1.42;
};

acl mynetwork {
  127.0.0.1;
  192.168.1.0/24;
};

options {
  listen-on port 53 { ns_ip_add; };
  listen-on-v6 port 53 { ::1; };
  directory "/var/named";
  dump-file "/var/named/data/cache_dump.db";
  statistics-file "/var/named/data/named_stats.txt";

  memstatistics-file "/var/named/data/named_mem_stats.txt";
  secroots-file "/var/named/data/named.secroots";
  recursing-file "/var/named/data/named.recursing";
  allow-query { localhost; mynetwork; };

```

```
allow-query { localhost; mynetwork; };
/*
If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
If you are building a RECURSIVE (caching) DNS server, you need to enable recursion.
If your recursive DNS server has a public IP address, you MUST enable access control to limit queries to your legitimate users. Failing to do so will cause your server to become part of large scale DNS amplification attacks. Implementing BCP38 within your network would greatly reduce such attack surface
recursion yes;

```

```
};

logging {
  channel default_debug {
    file "data/named.run";

    severity dynamic;
  };
};
dnssec-validation yes;
managed-keys-directory "/var/named/dynamic";
geoip-directory "/usr/share/GeoIP";
pid-file "/run/named/named.pid";
session-keyfile "/run/named/session.key";
/* <https://fedoraproject.org/wiki/Changes/CryptoPolicy> */
include "/etc/crypto-policies/back-ends/bind.config";

```

```
};

zone "." IN {
  type hint;
  file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";

```

### Restart BIND Service

```
systemctl restart named.service

```

### Restart Firewall

```
systemctl restart firewalld.service

```

### Test Setup

Use dig to Test DNS Resolution

```
dig google.com @192.168.1.34

```

# “change your client dns also your server ip “

# Forwarders Nameserver(**Forward DNS** allows a DNS server to pass unresolved queries to another server,)

## Edit Configuration for Forwarders

Edit the named.conf file:

```
vim /etc/named.conf

```

Here's an example named.conf configuration file for setting up forwarders:

```
// named.conf
//
// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
// server as a caching only nameserver (as a localhost DNS resolver only).
//
// See /usr/share/doc/bind/sample/ for example named configuration files.
//

acl ns_ip_add {
  127.0.0.1;
  192.168.1.32;
  192.168.1.40;
  192.168.1.41;
  192.168.1.42;
};

acl mynetwork {
  127.0.0.1;
  192.168.1.0/24;
};

options {
  listen-on port 53 { ns_ip_add; };
  listen-on-v6 port 53 { ::1; };
  directory "/var/named";

```

```
directory "/var/named";
dump-file "/var/named/data/cache_dump.db";
statistics-file "/var/named/data/named_stats.txt";
memstatistics-file "/var/named/data/named_mem_stats.txt";
secroots-file "/var/named/data/named.secroots";
recursing-file "/var/named/data/named.recursing";
allow-query { localhost; mynetwork; };

```

```
/*
If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
If you are building a RECURSIVE (caching) DNS server, you need to enable recursion.

If your recursive DNS server has a public IP address, you MUST enable access control to limit queries to your legitimate users. Failing to do so will cause your server to become part of large scale DNS amplification attacks. Implementing BCP38 within your network would greatly
reduce such attack surface
*/
recursion yes;
**forwarders {
  8.8.4.4; //change your ip to user server for forward the dns query
};**

```

```
dnssec-validation yes;
managed-keys-directory "/var/named/dynamic";
geoip-directory "/usr/share/GeoIP";

pid-file "/run/named/named.pid";
session-keyfile "/run/named/session.key";
/* <https://fedoraproject.org/wiki/Changes/CryptoPolicy> */
include "/etc/crypto-policies/back-ends/bind.config";

```

```
logging {
  channel default_debug {
    file "data/named.run";
    severity dynamic;
  };
};

zone "." IN {
  type hint;
  file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";

```

## Explanation of Forwarders

forwarders 8.8.8.8; 8.8.4.4; };

This section tells the DNS server to forward queries it can't resolve locally to Google's public DNS servers (8.8.8.8 and 8.8.4.4).

Forwarders improve resolution time and efficiency by caching frequently used queries.

### Restart BIND Service

```
systemctl restart named.service

```

Use dig to test DNS queries:

```
dig google.com

```

## Capture DNS Traffic Using tcpdump

Capture DNS traffic on port 53 using tcpdump:

```
tcpdump -t udp

```

```
tcpdump -i enpos3 port 53

```

```
tcpdump -n udp port 53

```

```
tcpdump -t udp i enp0s3 port 53

```

```
tcpdump -nt udp i enp0s3 port 53

```
